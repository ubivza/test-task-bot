# Тестовый бот

## Использованные технологии
- **Mapstruct**
- **Spring Boot**
- **Spring Data**
- **PostgreSQL**
- **Lombok**
- **Telegrambots lib**
- **Apache Commons** (email validation)
- **Liquibase**
- **Apache POI**
- **Docker**

## Описание доступных команд бота
1. **/start**  
   Выводит приветственное сообщение, опираясь на имя пользователя. Если имя скрыто, выводится приветствие незнакомца.

2. **/form**  
   Запускает цепочку опроса:  
   - Имя  
   - Email  
   - Оценка (1–10)  
   Email и оценка валидируются согласно ТЗ. Если вызвать эту же команду снова или любую другую доступную, опрос будет сброшен. В конце опроса данные сохраняются в базу данных.

3. **/report**  
   Запускает асинхронную генерацию отчета в формате `.docx` по всем записям опросов, используя сохраненные в базе данных данные.

## Архитектура приложения
- **Инициализация базы данных**:  
  Скрипт Liquibase создает таблицу `form` с полями:  
  - `id` SERIAL Primary Key  
  - `chat_id` BIGINT  
  - `name` VARCHAR(255)  
  - `email` VARCHAR(255)  
  - `rate` INTEGER  

- **Работа бота**:  
  - Прослушивание осуществляется по схеме **Long Polling**.  
  - Обработка обновлений реализована через паттерн **Стратегия**, который содержит допустимые команды.  
  - При вызове команды `/form` бот переходит в режим последовательной цепочки обработки, используя перечисление (**enum**) для управления состояниями диалога. Бот задает вопросы и принимает ответы последовательно.  

- **Управление сессиями**:  
  - Сессии хранятся в **ConcurrentHashMap** с TTL 10 минут.  
  - При необходимости возможно расширение с использованием **Redis**.  

- **Генерация отчетов**:  
  - Реализована с помощью библиотеки **Apache POI** в фасаде.  

## Запуск приложения
1. Склонируйте репозиторий командой:  
   ```bash
   git clone https://github.com/ubivza/test-task-bot.git
2. Переходим в папку куда он был выгружен.
3. В терминале или гит баше пишем команду docker compose up.
4. Проверяем работоспособность бота @TestTaskChatBot .
